# 需求功能跟踪记录

## 2025-10-05: 统计页面功能增强

本次更新针对“统计”页面进行了一系列的优化和功能增强。

### 1. 年度体重趋势图
- **功能**: 在统计页的图表部分，新增了按“年”筛选的视图。
- **实现**: 当用户选择“年”时，图表会展示过去12个月的体重趋势。数据点是每个月的平均体重，这提供了一个更宏观、更平滑的年度趋势概览。

### 2. 核心指标卡片布局优化
- **问题**: 当“总卡路里”数值过大时，在原有的2x2网格布局中显示不全。
- **优化**: 调整了卡片布局。第一行并排显示“体重变化”和“目标达成”，第二行和第三行分别独立显示“总卡路里”和“运动天数”。这为后两者提供了充足的显示空间。

### 3. UI/UX 细节打磨
- **动画**: 为四个核心指标卡片的数值增加了数字滚动动画，当数据更新时，数值会平滑过渡，与应用内其他卡片动画效果保持一致。
- **图表标签**: 优化了年度视图下X轴的月份标签，从“X月”改为仅显示数字“X”，避免了因标签过长导致的显示不全问题。
- **字体调整**: 适当调小了指标卡片中单位（如kg, %, kcal）的字体，优化了视觉层次。

---

## 2025-10-05: 健身计划管理系统与用户档案增强

本次更新引入了健壮的健身计划管理系统，并显著扩展了用户档案功能，为更个性化的用户体验奠定了基础。

### 1. 健身计划管理系统
- **功能**: 引入 `Plan` 和 `DailyTask` 模型，支持创建、管理和归档健身计划。
- **实现**:
    - `PlanViewModel` 负责计划的生成、加载和基于日期的过滤。
    - `PlanView` 作为核心标签页集成，包含自定义日历、每日锻炼/膳食计划展示、计划设置和历史计划视图。
    - 提供 `CalendarView` 和 `MonthView` 用于直观的日期选择和导航。
    - 包含 `PlanSetupView`、`PlanDetailView` 和 `PlanHistoryView`，用于完整的计划生命周期管理。

### 2. 用户档案增强
- **功能**: 扩展 `UserProfile` 模型，新增了大量属性（例如，体型、基准、详细偏好、健康状况），以捕获更丰富的用户数据。
- **实现**:
    - 更新了相关枚举（`FitnessGoal`、`Gender`、`WeightUnit` 等），并新增了 `BodyType`、`HealthCondition`、`Interest`、`Equipment`、`Motivator`、`Challenge`、`DietaryHabit`、`WaterIntake`、`SleepQuality` 等。

### 3. 健康指标与活动扩展
- **功能**: 扩展 `HealthMetric` 模型，新增了多种 `MetricType` 值（例如，胸围、体脂肪量、基础代谢率），以支持更广泛的健康跟踪。
- **实现**:
    - 增强了 `Meal` 和 `Workout` 模型，使其遵循 `Identifiable` 协议。

### 4. 成就系统集成
- **功能**: 将 `AchievementPopupView` 集成到 `ContentView` 中，表明引入了应用内成就系统。

### 5. 引导流程与 UI 优化
- **功能**: 优化了 `ContentView` 的引导流程逻辑和基于主题的 `TabView` 重建。

### 6. 文档
- **功能**: 添加了 `doc/plan.md`，详细说明了动态周期性计划系统的产品需求。