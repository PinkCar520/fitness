# PRD V3.4: 个性化计划生成引擎

**版本:** 3.4
**状态:** 需求已确认

---

## 1. 愿景与用户体验

### 1.1. 核心愿景

将 App 从一个被动的“记录工具”升级为一个主动的“智能健身伙伴”。通过深入理解用户并提供动态调整的训练内容，在用户旅程的每一个环节提供个性化、有指导性、安全且高效的健身体验，从而大幅提升新用户激活率、长期留存和用户满意度。

### 1.2. 用户体验旅程

#### 第一阶段：首次开启的“专属定制”体验 (前5分钟)
新用户打开 App 后，将立即进入一个对话式的引导流程。App 会像一个亲切的教练，通过提问快速了解用户的**健身目标、经验水平、锻炼场景**和**特殊身体状况**，并在每一步都给予清晰的反馈，快速建立信任感。最终，用户将见证一个为自己量身打造的专属计划“诞生”的“魔法时刻”。

#### 第二阶段：告别迷茫的“无缝开始”体验 (第一周)
用户将获得一个清晰、可立即执行的周计划，彻底告别“我今天该练什么？”的迷茫。计划中的所有内容，从训练日的安排到具体动作的选择，都完全贴合用户在引导流程中提供的信息，确保计划是**安全、合适、可上手**的。

#### 第三阶段：持续进化的“动态陪伴”体验 (长期使用)
App 会成为一个能“学习”和“适应”的伙伴。它会根据用户的**实际运动表现**（例如，举重重量增加）和**主观反馈**（例如，用户评价某次训练“太难”），在未来动态调整计划的难度和内容。这种持续进化的体验，将让用户感觉拥有一个真正关心自己成长过程的私人教练。

---

## 2. 功能需求规格

### 2.1. Phase 1 (MVP): 基于规则的初始计划生成

此阶段为项目的第一步，目标是为新用户成功生成一个高质量的初始个性化计划。

#### 2.1.1. 数据输入
系统将主要依赖在 Onboarding 流程中，从 `UserProfile` 模型收集的以下数据：
*   **健身目标 (`goal`):** 减脂塑形, 增肌与力量, 提升健康与活力。
*   **经验水平 (`experienceLevel`):** 纯新手, 有一定经验, 经验丰富。
*   **锻炼场景 (`workoutLocation`):** 居家训练, 健身房。
*   **健康状况 (`healthConditions`):** 膝盖不适, 腰部不适等。
*   **可用设备 (`equipment`):** 哑铃, 弹力带, 瑜伽垫等。

#### 2.1.2. 核心生成逻辑
*   **实现位置:** 此逻辑将作为 `fitness/Managers/RecommendationManager.swift` 的核心功能进行开发。
*   **执行方式:** 建议在 `RecommendationManager` 中创建一个全新的方法 `generateInitialWorkoutPlan() -> Plan`，专门负责此任务。
*   **规则示例 (部分):**
    *   **规则集A (目标+水平):**
        *   `IF goal = '减脂' AND experienceLevel = '新手'` -> `RETURN` 每周3次全身力量训练 + 2次低强度有氧。
        *   `IF goal = '增肌' AND experienceLevel = '中级'` -> `RETURN` 每周4次上下肢分离训练。
    *   **规则集B (场景+设备):**
        *   `IF workoutLocation = '居家' AND equipment CONTAINS '哑铃'` -> `THEN` 训练动作池将仅包含徒手和哑铃动作。
    *   **规则集C (健康状况):**
        *   `IF healthConditions CONTAINS '膝盖不适'` -> `THEN` 从动作池中**排除**所有高冲击性动作（如深蹲跳、弓步跳等）。

#### 2.1.3. 输出
*   **格式:** 逻辑的最终输出是一个结构化的 `Plan` 对象。
*   **内容:** 该 `Plan` 对象包含了未来1-4周的完整训练安排，包括每日的 `DailyTask` 以及每个任务中具体的 `Workout` 列表（包含动作、建议组数、次数等）。

### 2.2. Phase 2 (未来迭代): 自适应调整与优化
*   **反馈循环:** 监听 `WorkoutSessionManager` 的训练完成数据和用户在 `WorkoutSummaryView` 中提交的主观反馈。
*   **智能调适:** 根据用户反馈（“太难”/“太简单”）和表现数据（重量/速度提升），自动调整后续计划的强度、容量或动作复杂度。
*   **周期性评估:** 每4-6周引导用户进行一次能力评估，并根据结果刷新长期计划。

---

## 3. UI 集成与交互展示

### 3.1. 计划的展示
*   **概览页 (`SummaryDashboardView`):** 在 App 主页，通过“今日训练”卡片突出展示当日计划，并提供一键“开始训练”的快捷入口。
*   **计划页 (`PlanView`):** 通过周视图(`WeeklyPlanView`)和日视图(`DayDetailCardView`)完整展示周度计划和每日的详细训练内容（动作、组数、次数）。

### 3.2. 计划的执行
*   **实时训练 (`LiveWorkoutView`):** 用户点击“开始训练”后，进入沉浸式跟练界面。界面将提供清晰的动作演示、目标指引和便捷的数据记录方式（非键盘输入），引导用户逐步完成训练。

---

## 4. 技术实现说明 (MVP)

*   **数据模型:** 现有的 `UserProfile.swift` 和 `Plan.swift` 模型结构良好，可直接支持 MVP 阶段的需求。
*   **核心逻辑:**
    1.  重构 `RecommendationManager.swift`，在保留现有饮食推荐逻辑的基础上，新增 `generateInitialWorkoutPlan() -> Plan` 方法。
    2.  在该方法内部，实现 Phase 1 中定义的规则引擎。
    3.  需要预设一个训练动作库（可先硬编码在代码或 JSON 中），包含每个动作的元数据（例如：目标肌肉、适用设备、难度等级、是否高冲击）。
*   **UI 集成:**
    1.  在 `OnboardingFlowView` 完成后，调用 `RecommendationManager.generateInitialWorkoutPlan()`。
    2.  将生成的 `Plan` 对象存入 SwiftData。
    3.  确保 `PlanView` 和 `SummaryDashboardView` 能够正确读取并展示这个新生成的计划。
