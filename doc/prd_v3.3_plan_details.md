# V3.3 版本规划详情：智能与激励

**版本:** 3.3
**状态:** 规划中

---

## 1. 版本总目标

在 V3 坚实的功能框架之上，通过引入“数据驱动的个性化”和“强效的视觉激励”，将应用从一个高效的“记录工具”升级为一个更懂用户的“智能健身伙伴”，进一步提升用户粘性和长期价值。

---

## 2. 核心功能详述

### 2.1. 真实卡路里消耗计算

- **用户价值:** “我的努力到底消耗了多少？”——为用户提供更精确、更个性化的能量消耗反馈，增强数据的可信度和参考价值，让用户的每一次流汗都能量化可见。

- **功能详述:**
  1.  **引入 METS 公式:** 采用业界成熟的 `总消耗 = MET值 * 体重(kg) * 运动时长(h)` 公式作为核心计算模型。
  2.  **自动获取体重:** 计算时，系统需自动读取用户在“身体档案”中记录的最新体重数据。若无记录，可采用默认值并提示用户输入。
  3.  **建立 MET 值库:** 在应用内部建立一个 MET (Metabolic Equivalent of Task) 值映射表。
      - **有氧运动:** 根据用户在训练中记录的`距离`和`时长`计算出配速，匹配到更精确的 MET 值（例如，10km/h的跑步 MET 值为10，而 6km/h 的慢走 MET 值仅为 3.5）。
      - **力量训练:** 初期版本，采用一个固定的平均 MET 值（例如，中等强度 `4.0`）。
      - **其他运动:** 根据运动名称赋予一个通用的中低强度 MET 值（例如，瑜伽 `2.5`，拉伸 `2.0`）。
  4.  **无缝集成:** 该计算过程对用户完全透明。用户在 `LiveWorkoutView` 中完成训练后，`WorkoutSessionManager` 在保存 `Workout` 记录时，调用此计算服务，将计算结果存入 `caloriesBurned` 字段。

- **验收标准:**
  - [ ] 训练总结页显示的卡路里消耗值是经过新公式计算的。
  - [ ] 同样时长的同一运动，体重较大的用户计算出的消耗值更高。
  - [ ] 同样时长的跑步，速度（配速）越快，计算出的消耗值越高。
  - [ ] 用户未记录体重时，会得到合理的提示。

---

### 2.2. 身体档案视觉记录

- **用户价值:** “我真的变了吗？”——数字是抽象的，而视觉对比是健身路上最强大、最原始的动力来源。本功能旨在为用户提供一个见证自己蜕变的“时光机”。

- **功能详述:**
  1.  **入口:** 在“身体档案” (`BodyProfileView`) 页面，增加一个醒目的入口，如“我的蜕变照片墙”。
  2.  **照片墙:** 点击入口后，进入专属的照片管理页面。所有照片按日期倒序，以宫格形式清晰展示。
  3.  **照片添加:** 用户可通过“+”按钮，选择`从相册选取`或`立即拍摄`来上传照片。上传时，照片会自动关联当天日期，用户也可手动修改。
  4.  **核心 - 对比视图:**
      - 在照片墙页面，提供一个“对比”按钮。
      - 点击后，用户可以选择任意两张照片。
      - 系统将生成一张专门用于对比的视图，左右（或上下）并列展示两张照片，并在每张照片上方清晰标注**日期**和**当时的体重**。
  5.  **分享:** 对比视图提供“分享”或“保存到相册”的功能，让用户可以轻松地将自己的成果分享给朋友。

- **验收标准:**
  - [ ] 用户可以成功上传、查看和删除照片。
  - [ ] 用户可以选择任意两张照片生成对比图。
  - [ ] 对比图上必须清晰展示两张照片的日期和体重。
  - [ ] 对比图可以被成功保存到手机相册。

- **技术说明:**
  - **数据模型:** 需创建新的 SwiftData 模型 `BodyPhoto(id: UUID, date: Date, imagePath: String)`。
  - **图片存储:** V1 版本，图片文件存储在应用本地的 Documents 目录下即可。

---

### 2.3. 个性化计划生成

- **用户价值:** “这个计划适合我吗？”——将“一刀切”的模板计划，升级为更贴合用户当前能力的“入门”计划，解决“太难跟不上”或“太简单没效果”的核心痛点，提升计划的科学性和执行率。

- **功能详述:**
  1.  **增加“经验水平”输入:** 在 `PlanSetupView`（计划设置页面），在原有“目标”、“时长”等选项基础上，增加一个必选项：“您的经验水平？”，选项为 `新手` / `中级` / `高级`。
  2.  **重构 `generatePlan` 逻辑:** `PlanViewModel` 中的 `generatePlan` 方法需进行重构，以支持差异化内容生成。
      - **新手:** 生成的训练计划中，每个力量训练动作包含 **3 组**，每组 **12-15 次**。
      - **中级:** 每个力量训练动作包含 **3-4 组**，每组 **8-12 次**。
      - **高级:** 每个力量训练动作包含 **4-5 组**，每组 **6-10 次**。
  3.  **训练动作池 (可选优化):** 可为不同目标（减脂/增肌）和不同水平，预设不同的训练动作库，使计划内容更丰富。

- **验收标准:**
  - [ ] 计划设置页面出现了“经验水平”选项。
  - [ ] 选择“新手”后生成的计划，其力量训练组数和次数符合预设标准 (3组, 12-15次)。
  - [ ] 选择“中级”和“高级”后生成的计划，同样符合各自的预设标准。

---

### 2.4. 沉浸式计划执行优化

- **用户价值:** 彻底消除训练过程中的键盘干扰，实现快速、直观、无缝的数据记录与确认，让用户全身心投入训练，提升专注度和效率。

- **功能详述:**
  1.  **核心原则：** 训练过程中，**避免出现输入框和键盘**。
  2.  **力量训练（组数、次数、重量）交互优化：**
      - **数据预填充：** 当用户开始一个力量训练动作时，系统自动预填充该动作上次训练的次数和重量。
      - **快速调整：** 在预填充的次数和重量数值旁，提供大尺寸的 `+` 和 `-` 按钮进行快速微调。点击数值本身，可弹出一个非侵入式的、半透明滚轮选择器（类似 iOS 时间选择器），用于大幅度调整，完成后自动收起。
      - **明确确认：** 每组训练下方设置一个醒目的“完成”按钮。用户调整数据后，点击此按钮确认该组完成，并触发休息计时器。
  3.  **有氧训练（距离、时长）交互优化：**
      - **时长自动追踪：** 训练会话计时器自动追踪时长。
      - **距离快速调整：** 预填充目标距离，提供 `+` 和 `-` 按钮或滚轮选择器进行调整。
      - **明确确认：** 训练结束后，点击“完成”按钮确认。
  4.  **其他训练（笔记）交互优化：**
      - **训练中：** 提供一组可快速点选的预设标签（如“感觉良好”、“有点累”、“轻松”）或表情符号，用于快速标记训练感受。
      - **训练后：** 在训练总结页面，提供专门的“添加笔记”区域，允许用户在训练结束后进行详细文字记录。

- **验收标准:**
  - [ ] 力量训练中，用户无需唤出键盘即可完成次数和重量的记录与调整。
  - [ ] 有氧训练中，用户无需唤出键盘即可完成距离的记录与调整。
  - [ ] “其他”训练中，用户可以通过点选标签快速记录感受。
  - [ ] 每组训练的“完成”操作清晰明确，并伴随正确的反馈。
